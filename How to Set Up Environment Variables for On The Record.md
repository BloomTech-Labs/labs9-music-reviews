# How to Set Up Environment Variables for "On The Record"

We are using the following APIs/services:
1. Spotify
2. Firebase
3. Stripe

# Spotify Developer Login (To get access token)

1. To set up, visit https://developer.spotify.com/ and register for a developer account.
2. Upon reaching Dashboard, click "Create Client ID" to generate an application. (You will be asked if the application is being monetized)
3. Make a note of Client ID and Client Secret.
4. Go to "Edit Settings" on the same page. (Green button on right)
5. Under "Redirect URI", add the following: YOUR_BACKEND_URL/spotify/callback (This is crucial to retrieving data from Spotify's API)
6. Configure your environment variables on your back end for **CLIENT_ID**, **CLIENT_SECRET**, and **REDIRECT_URI** from steps 3 and 5.
    **CLIENT_ID = client id**
    **CLIENT_SECRET = client secret**
    **REDIRECT_URI = (YOUR_BACKEND_URL/spotify/callback)**
7. On server's deployment/initialization, go to YOUR_BACKEND_URL/spotify/login and it should prompt you to log in with your Spotify account (note: use your Spotify's developer account where you used to create your app and obtained the client ID and client secret, or else it won't work.)
8. After successful authentication, you should be redirected to a page with a JSON object with a key/value pair of "access_token".

# Stripe
1. Sign up for an account at https://dashboard.stripe.com/
2. After activating your account, navigate to Developers on the side menu and click "API Keys"
3. You should see two fields, "Publishable Key" and "Secret Key".
4. Set the following environment variable:
    **STRIPE_SECRET_KEY = (Secret Key)**

# Firebase (back end)
### Back end
1. Sign up for an account for Firebase on https://firebase.google.com/
2. Go to "Console" once you have signed up.
3. Add a project to your account.
4. Under "Develop," go to "Authentication" then "Sign-in method." Make sure both Email/Password and Google are enabled.
5. On the same page, scroll down to Authorized domains. Localhost and the Firebase's application should be added there already. In addition, you will need to add both your FRONT_END_URL and BACK_END_URL.
6. Go to Settings (located next to Project Overview), and click "Project Settings"
7. Go to "Service accounts" and click "Generate new private key." A JSON file should be downloaded. Use any code editor to open the JSON file.
8. The JSON file contains some sensitive information about your application.
9. Configure the following environment variables with the fields found in the JSON file:
        **FIREBASE_CLIENT_EMAIL = client_email**
        **FIREBASE_PRIVATE_KEY = private_key**
        **FIREBASE_PROJECT_ID = project_id**
10. That's the set up for Firebase on back end. More configurations are needed on the front end if you have not done so.

### Front end
1. Please go back to the previous section setting up Firebase on the back end if you have not done so.
2. Using the same JSON file generated in the Firebase backend instructions (step 7), configure the following environment variable:
        **REACT_APP_PROJECT_ID = project_id**
3. Go back to your Firebase dashboard/console and navigate to "Settings."
4. You will navgiate to the following pages in "Settings" to set up additional environment variables:
    * Variable on the page will be noted as (VARIABLE_NAME)
    a.  General
        **REACT_APP_API_KEY = (WEB API Key)**
    b. Cloud Messaging
        **REACT_APP_MESSAGING_SENDER_ID = (Sender ID)**
    c. Service Accounts
    /Inside the window for "Admin SDK configuration snippet," select Node.js and find databaseURL in there/
        **REACT_APP_DATABASE_URL = (databaseURL)**
5. Navigate to "Authentication" on the side menu => Sign-in Method. On that page, scroll to "Authorized domains." Note one of the authorized domains (should be YOUR_APP_NAME.fireabaseapp.com)
        **REACT_APP_AUTH_DOMAIN = (YOUR_APP_NAME.fireabaseapp.com)**
6. Navigate to "Storage" on the side menu. Under the files tab, note the URL (gs://YOUR_APP_NAME.appspot.com)
        **REACT_APP_STORAGE_BUCKET = (YOUR_APP_NAME.appspot.com)**

## Other Environment Variables
Please set the following environment variables:
### Front end
    REACT_APP_CONFIRMATION_EMAIL_REDIRECT = (YOUR_FRONTEND_URL)
    REACT_APP_PAYMENT_SERVER_URL = (YOUR_BACKEND_URL)/payment
    REACT_APP_FRONTEND_URL = (YOUR_FRONTEND_URL)
    REACT_APP_BACKEND_URL = (YOUR_BACKEND_URL)
    REACT_APP_TOKEN_URL = (YOUR_BACKEND_URL)/spotify/get_token
    REACT_APP_REFRESH_TOKEN_URL = (YOUR_BACKEND_URL)/spotify/refresh_token

*Special Note: STRIPE PUBLISHABLE KEY*
This will need to be set in one of the files in the code.
1. Navigate to  Front_end/src/Components/Settings/Checkout.js
2. Change the value of `const STRIPE_PUBLISHABLE_KEY` to the Publishable Key found on Stripe's dashboard.

### Back end
    DATABASE_URL = (Auto-generated by Heroku if you added the Postgres add-on)
    DB = production
    PROJECT_PATH = Back_end - *Add the following buildpack on Heroku https://github.com/timanovsky/subdir-heroku-buildpack.git*

# List of Environment Variables
### Back end (10)
    CLIENT_ID
    CLIENT_SECRET
    REDIRECT_URI
    FIREBASE_CLIENT_EMAIL
    FIREBASE_PRIVATE_KEY
    FIREBASE_PROJECT_ID
    STRIPE_SECRET_KEY
    DATABASE_URL
    DB
    PROJECT_PATH

    
### Front end (12)
    REACT_APP_API_KEY
    REACT_APP_AUTH_DOMAIN
    REACT_APP_DATABASE_UR
    REACT_APP_PROJECT_ID
    REACT_APP_STORAGE_BUCKET
    REACT_APP_MESSAGING_SENDER_ID
    REACT_APP_CONFIRMATION_EMAIL_REDIRECT
    REACT_APP_PAYMENT_SERVER_URL
    REACT_APP_FRONTEND_URL
    REACT_APP_BACKEND_URL
    REACT_APP_TOKEN_URL
    REACT_APP_REFRESH_TOKEN_URL


